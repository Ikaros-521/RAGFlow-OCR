# RAGFlow OCR

基于RAGFlow的OCR功能独立拆分版本，支持文本检测和识别。

## 功能特性

- 文本检测 (Text Detection)
- 文本识别 (Text Recognition) 
- 支持GPU加速
- 支持批量处理
- 支持多种图像格式

## 安装

```bash
pip install -r requirements.txt
```

## 模型下载

首次使用需要下载模型文件：

```bash
python download_models.py
```

## 快速开始

```python
from ocr import OCR
import cv2

# 初始化OCR
ocr = OCR()

# 读取图像
image = cv2.imread('test.jpg')

# 执行OCR
result = ocr(image)

# 输出结果
for bbox, (text, score) in result:
    print(f"文本: {text}, 置信度: {score:.3f}, 位置: {bbox}")
```

## 高级用法

```python
# 指定模型路径
ocr = OCR(model_dir="./custom_models")

# 指定设备ID
result = ocr(image, device_id=0)

# 批量处理
images = [cv2.imread(f'img_{i}.jpg') for i in range(5)]
results = [ocr(img) for img in images]
```

## 输出格式

OCR返回格式为：
```python
[(bbox, (text, score)), ...]
```

其中：
- `bbox`: 文本边界框坐标 `[[x1,y1], [x2,y2], [x3,y3], [x4,y4]]`
- `text`: 识别的文本内容
- `score`: 识别置信度 (0-1)

## 依赖

- onnxruntime
- opencv-python
- numpy
- Pillow
- huggingface_hub (用于模型下载)

## 性能测试

显卡：NVIDIA RTX 4090D 24GB  
CPU：Intel I9-9900X @3.50GHz


📊 CPU vs GPU 性能对比总结


🎯 小图片 (500x300) (0.1 MPix)
------------------------------------------------------------
指标                   CPU          GPU          提升
------------------------------------------------------------
平均处理时间               0.094秒    0.020秒    4.7x  
识别速度                 10.6文本/秒  49.7文本/秒  4.7x  
图片处理速度               1.6MPix/s   7.4MPix/s   4.7x  
🎉 GPU 加速效果显著!

🎯 中等图片 (1000x600) (0.6 MPix)
------------------------------------------------------------
指标                   CPU          GPU          提升
------------------------------------------------------------
平均处理时间               0.051秒    0.052秒    1.0x  
识别速度                 58.4文本/秒  57.1文本/秒  1.0x  
图片处理速度               11.7MPix/s   11.4MPix/s   1.0x  
⚖️ CPU 和 GPU 性能相近

🎯 大图片 (1500x900) (1.4 MPix)
------------------------------------------------------------
指标                   CPU          GPU          提升
------------------------------------------------------------
平均处理时间               0.058秒    0.060秒    1.0x  
识别速度                 85.7文本/秒  83.0文本/秒  1.0x  
图片处理速度               23.1MPix/s   22.4MPix/s   1.0x  
⚖️ CPU 和 GPU 性能相近

🎯 超大图片 (2000x1200) (2.4 MPix)
------------------------------------------------------------
指标                   CPU          GPU          提升
------------------------------------------------------------
平均处理时间               0.074秒    0.072秒    1.0x  
识别速度                 108.1文本/秒  111.2文本/秒  1.0x  
图片处理速度               32.4MPix/s   33.4MPix/s   1.0x  
⚖️ CPU 和 GPU 性能相近

🎯 4K图片 (3840x2160) (8.3 MPix)
------------------------------------------------------------
指标                   CPU          GPU          提升
------------------------------------------------------------
平均处理时间               0.348秒    0.348秒    1.0x  
识别速度                 100.6文本/秒  100.6文本/秒  1.0x  
图片处理速度               23.8MPix/s   23.8MPix/s   1.0x  
⚖️ CPU 和 GPU 性能相近